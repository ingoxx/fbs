<view class="box">
  <!-- 提醒事项 -->
  <view class="notice">
    <van-notice-bar
      scrollable
      mode="closeable"
      speed="85"
      left-icon="volume-o"
      text="{{ notice }}"
    />
  </view>
  <!-- 定位 -->
  <view class="location">
    <block wx:if="{{ addr == '未获取位置' }}">
      <van-icon name="location" custom-class="van-icon-l"/> <text class="coordinate" >{{ addr }}</text>
    </block>
    <block wx:else>
      <van-icon name="location" custom-class="van-icon-l"/> <text class="coordinate" bind:tap="openMapApp">您现在的位置: 【{{ addr }}】</text> 
    </block>
  </view>
  <!-- 用户个人信息 -->
  <!-- <view class="userinfo">
    <view class="user-img">
      <button class="img-btn" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
        <van-image custom-class="van-img-1" src="{{avatarUrl}}" />
      </button>
    </view>
    <view class="user-name" bind:tap="openNickName">
      <view class="name">
        <text wx:if="{{nick_name != '' }}">{{ nick_name }}</text>
        <text wx:else>{{ userid }}</text>
      </view>
      <view class="time">
        <view class="time-status"></view><text class="online">运动狂人</text>
      </view>
    </view>
    <view class="user-tag">
      <van-tag custom-class="van-tag-1" color="#ffe534" text-color="#333333"><van-icon name="https://ai.anythingai.online/static/profile3/star.svg" />{{defaultSportSquare}}</van-tag>
    </view>
  </view> -->
  <!-- 搜索场地 -->
  <view class="search">
    <view class="s-p">
      <van-search
      custom-class="van-search-1"
      value="{{ inputValue }}"
      shape="round"
      background="#7880dd"
      placeholder="请输入搜索关键词"
      bindchange="newGetVal"
      clearable
      disabled="{{ isInput }}"
      />
    </view>
    <view class="s-b">
      <van-row gutter="8">
        <block wx:for="{{ basketSquareFilter }}" wx:key="index" wx:for-item="item">
          <van-col span="{{item.customize == 1 ? 10 : 8}}" custom-class="van-c" wx:if="{{ item.disable }}">
            <van-button round size="small" disabled="{{ item.isDisable }}" custom-class="van-btn-1" custom-style="{{ item.customize == 1 ? 'width:220rpx' : 'width:170rpx'  }}"  data-id="{{item.id}}" custom-class="{{ currentSquareSelected === item.id ? 'van-b-isactive' : 'van-b-isnotactive' }}" bind:click="onSelected">
              <van-icon name="{{ item.icon }}" /> {{ item.name }}
            </van-button>
          </van-col>
        </block>
      </van-row>
    </view>
  </view>
  <!-- 展示附近场地 -->
  <view class="card-1">
    <block wx:for="{{ basketSquareFilterData }}" wx:key="index" wx:for-item="item">
      <van-transition show="{{ isUse }}" custom-class="block">
        <view class="card-1-1">
          <!-- 当前场地活跃度 -->
          <view class="online-status">
            <!-- <van-icon color="{{ item.join_user_count > 0 ? '#ff6161': '#909090' }}" name="fire" /> -->
            <view class="venue-hot">
              <van-icon color="{{ item.join_user_count > 0 ? '#ff6161': '#909090' }}" name="fire" />
            </view>
            <!-- <view class="venue-img" data-index="{{index}}" bind:tap="toggleShowVenueImg">
              <van-icon color="#ff6161" name="https://ai.anythingai.online/static/profile3/pic.svg" />
            </view> -->
          </view>
          <!-- 场地地址 -->
          <view class="addr">
            <view class="sport-icon">
              <!-- 真实场地图片 -->
              <block wx:if="{{ item.img != '' }}">
                <van-image custom-class="van-img-1" radius="10"  fit="cover" src="{{item.img}}" data-src="{{item.img}}" data-imgs="{{item.images}}" bind:click="onPreviewVenueImage" />
              </block>
              <!-- 没有就用其他代替 -->
              <block wx:else>
                <block wx:for="{{ all_sport_list }}" wx:key="index3" wx:for-item="item3" >
                  <van-image data-src="{{item3.img}}" custom-class="van-img-1" radius="10" wx:if="{{ defaultSportKey == item3.key }}" fit="cover" src="{{item3.img}}" data-src="{{item3.img}}" bind:click="onPreviewImage" />
                </block>
              </block>
            </view>
            <view class="sport-addr" data-item="{{ item }}" bind:tap="openMapAppDetailed">
              <view class="sport-addr-name">
                <text class="t-f">{{ item.addr }}</text>
              </view>
              <view class="sport-addr-tag">
                <block wx:for="{{ item.tags }}" wx:key="index" wx:for-item="item2">
                  <block wx:for="{{ all_sport_list }}" wx:key="index3" wx:for-item="item3">
                    <van-tag  size="mini" type="success" wx:if="{{ defaultSportKey == item3.key }}">
                      {{ item3.icon }}{{ item2 }}
                    </van-tag>
                  </block>
                </block>
                <text class="nav">点击导航</text>
              </view>
            </view>
          </view>
          <!-- 场地图片更新 -->
          <block>
            <van-transition show="{{ item.is_show }}" custom-class="block">
              <view class="venue-img-update">
                <view class="title">
                  <text>添加场地图片目前只能传1张</text>
                </view>
                <view class="img">
                  <van-uploader 
                  max-count="1"
                  multiple
                  preview-image
                  deletable
                  file-list="{{ fileList }}" 
                  bind:after-read="afterRead" 
                  bind:delete="deleteImg"
                  />
                </view>
                <view class="submit-img">
                  <van-button bind:tap="updateVenueImg" data-index="{{ index }}" data-item="{{ item }}" icon="https://ai.anythingai.online/static/profile3/smil.svg" custom-style="width: 170rpx" size="small" round type="info">上传</van-button>
                </view>
              </view>
            </van-transition>
          </block>
          <!-- 场地距离 -->
          <view class="distance" data-item="{{ item }}">
            <!-- <van-icon name="location" custom-class="van-icon-3"/> <text class="t-f">距您{{ item.distance }}公里, </text><text class="t-f-1">点击导航</text>
            <van-tag round type="success" custom-class="{{ item.online == 0 ? 'van-tag-c': 'van-tag-c-1' }}"><van-icon name="friends" /> {{ item.online }}人在线</van-tag> -->
            <view class="online-users">
              <view class="num">
                <text>{{ item.online }}</text>
              </view>
              <view class="title">
                <van-icon name="friends-o" /><text class="title-name">活跃人数</text>
              </view>
            </view>
            <view class="users-reviews">
              <view class="num">
                <text>{{ item.user_reviews_count }}</text>
              </view>
              <view class="title">
                <van-icon name="like-o" /><text class="title-name">用户赞美</text>
              </view>
            </view>
            <view class="square-distance">
              <view class="num">
                <text>{{ item.distance }}km</text>
              </view>
              <view class="title">
                <van-icon name="location-o" /><text class="title-name">离您距离</text>
              </view>
            </view>
          </view>
          <!-- 用户对当前球场的评价 -->
          <view class="evaluate-top" >
            <view class="evaluate" data-item="{{ item }}" bind:tap="isShowEvaBoard">
              <swiper autoplay="true" interval="3000" circular style="height: 60rpx;">
                <swiper-item wx:for="{{item.user_reviews}}" wx:key="index" wx:for-item="item2">
                  <view class="review-card">
                    <view class="o-user" style="margin-right:-7px;">
                      <van-image width="100%"
                      round
                      height="100%"  fit="cover" src="{{item2.img}}" />
                    </view>
                    <view class="user-evaluate">
                      <text>{{item2.evaluate}}</text>
                    </view>
                  </view>
                </swiper-item>
              </swiper>
            </view>
            <view class="view-sign" data-item="{{ item }}" bind:tap="isShowEvaBoard">
              <van-icon name="https://ai.anythingai.online/static/profile3/view.svg" />
            </view>
          </view>
          <!-- 用户加入/退出组队 -->
          <view class="group-status">
            <!-- 组队 -->
            <van-button round size="small" type="{{ item.hasJoined ? 'info' : 'warning' }}" custom-style="width:218rpx" data-item="{{ item }}" bind:tap="joinSportGroup">
              {{item.hasJoined ? '⚡退出组队' : '⚡加入组队'}}({{item.join_user_count}})
            </van-button>
            <!-- 拍照 -->
            <van-button round size="small" data-index="{{index}}" custom-style="width:218rpx" data-item="{{ item }}"  bindtap="toggleShowVenueImg">
              <van-icon size="30rpx" custom-class="van-icon-5" name="https://ai.anythingai.online/static/profile3/pic2.svg" /><text class="group_title">上传场地图片</text>
            </van-button>
            <!-- 组 -->
            <!-- <van-button round size="small" custom-style="width:110rpx" data-item="{{ item }}"  bindtap="chatRoom">
              <text class="group_title">💬</text>
            </van-button> -->
          </view>
          <!-- 加入组队的用户头像 -->
          <view class="show-join-user" wx:if="{{ item.join_user_count > 0 }}">
            <block wx:for="{{ item.join_users }}" wx:key="index" wx:for-item="item2" wx:for-index="idx">
              <view class="o-user" style="margin-right:-10px;">
                <van-image width="100%" round height="100%"  fit="cover" src="{{item2.img}}" />
              </view>
            </block>
            <view class="join-users">
              <text>{{item.join_user_count}}人加入组队</text>
            </view>
          </view>
        </view>
      </van-transition>
    </block>
    <block wx:if="{{ isEmpty }}">
      <van-empty description="{{ isUse ? useNotice: '请先同意用户隐私协议' }}"></van-empty>
    </block>
  
  </view>
  <!-- 客服 -->
  <view class="contact-us">
    <van-transition show="{{ showServiceBtn }}" custom-class="block" name="slide-left" duration="0">
      <view class="tran-1">
        <button size="mini"  open-type="contact" class="share-btn"><van-icon name="https://ai.anythingai.online/static/profile3/service.svg" /></button>
      </view>
    </van-transition>
    <view class="tran-2" data-id="1" bind:tap="onSwitchContactBtn">
      <van-icon size="90rpx" name="https://ai.anythingai.online/static/profile3/side-3.svg" />
    </view>
  </view>
  <!-- 页面刷新 -->
  <view class="flush-data" wx:if="{{isUse}}">
    <view class="tran-2" data-id="2" bind:tap="onSwitchContactBtn">
      <van-icon size="90rpx" custom-class="van-icon-4" name="https://ai.anythingai.online/static/profile3/side-3.svg" />
    </view>
    <van-transition show="{{ showFlushBtn }}" custom-class="block" name="slide-right" duration="0">
      <view class="tran-1">
        <button size="mini" bind:tap="getOpenid" class="share-btn">
          <van-icon name="https://ai.anythingai.online/static/profile3/flush-5.svg" />
        </button>
      </view>
    </van-transition>
  </view>
  <!-- 回复用户 -->
  <view class="message-reply" wx:if="{{isAdminShow}}">
    <view class="tran-2" data-id="3" bind:tap="onSwitchContactBtn">
      <van-icon size="90rpx" custom-class="van-icon-4" name="https://ai.anythingai.online/static/profile3/side-3.svg" />
    </view>
    <van-transition show="{{ showReplyBtn }}" wx:if="{{showReplyBtn}}" custom-class="block" name="slide-right" duration="0">
      <view class="tran-1">
        <button size="mini" bind:tap="isShowChatRoom" class="share-btn">
          <van-icon name="https://ai.anythingai.online/static/profile3/mr.svg" />
        </button>
      </view>
    </van-transition>
  </view>
  <!-- 用户列表 -->
  <view class="user-list" wx:if="{{isAdminShow}}">
    <view class="tran-2" data-id="4" bind:tap="onSwitchContactBtn">
      <van-icon size="90rpx" custom-class="van-icon-4" name="https://ai.anythingai.online/static/profile3/side-3.svg" />
    </view>
    <van-transition show="{{ showUsersBtn }}" wx:if="{{showUsersBtn}}" custom-class="block" name="slide-right" duration="0">
      <view class="tran-1">
        <button size="mini" bind:tap="getUserList" class="share-btn">
          <van-icon name="https://ai.anythingai.online/static/profile3/user_list.svg" />
        </button>
      </view>
    </van-transition>
  </view>
</view>
<!-- 一些第三放组件或者自定义的组件 -->
<view>
  <!-- 昵称 -->
  <van-popup
    show="{{ showNickName }}"
    position="bottom"
    custom-style="height: 18%"
    bind:close="onCloseNickName"
    round
  >
    <input bind:change="chooseNickName" type="nickname" class="wx-nickname" placeholder="请输入昵称"/>
  </van-popup>
  <!-- 留言框 -->
  <van-popup
    wx:if="{{ showEvaBoard }}"
    show="{{ showEvaBoard }}"
    round
    custom-style="height: 50%;width: 80%;"
    bind:close="onCloseEvaBoard"
  >
    <eva-board evaluate_list="{{evaluate_list}}" info_data="{{ info_data }}"></eva-board>
  </van-popup>
  <!-- 聊天框 -->
  <van-popup
    wx:if="{{ showChatRoom }}"
    show="{{ showChatRoom }}"
    round
    custom-style="height: 40%;width: 80%; background:#374151"
    bind:close="onCloseChatRoom"
  >
    <chat-room wssUrl="{{ wssUrl }}" user_id="{{user_id}}" sender_id="{{sender_id}}" baseUrl="{{ baseUrl }}" class="com-chat-room"></chat-room>
  </van-popup>
  <!-- 用户添加场地 -->
  <van-dialog
    use-slot
    title="添加场地"
    show="{{ addVillage }}"
    show-cancel-button
    confirm-button-open-type="getUserInfo"
    bind:close="onClose"
    bind:confirm="onConfirmAddPlace"
    custom-class="van-dialog-c-1"
  >
    <van-cell-group>
      <van-field
        value="{{ villageInfo }}"
        required
        clearable
        autosize
        type="textarea"
        label="地址"
        placeholder="请输入详细的场地地址"
        confirm-type="done"
        bind:change="onChangeAddAddrField"
      />
      <van-field
        value="{{ placeTag }}"
        required
        clearable
        autosize
        type="textarea"
        label="简称"
        placeholder="如: 新湖{{defaultSportSquare}}"
        border="{{ false }}"
        confirm-type="done"
        bind:change="onChangeAddTagField"
      />
      <view class="add-square-img">
        <view class="title">
          <text>添加场地图片目前只能传1张</text>
        </view>
        <view class="img">
          <van-uploader 
          max-count="1"
          multiple
          preview-image
          deletable
          file-list="{{ fileList }}" 
          bind:after-read="afterRead" 
          bind:delete="deleteImg"
          />
        </view>
      </view>
    </van-cell-group>
  </van-dialog>
  <!-- 运动场地选择 -->
  <van-dialog
      use-slot
      cancel-button-text="关闭"
      z-index="100"
      title="🏃运动场地选择"
      show="{{ showSportsList }}"
      show-cancel-button
      confirm-button-open-type="getUserInfo"
      bind:close="onClose"
      bind:confirm="onConfirmSportSelection"
    >
      <view class="sports-list-box">
        <block wx:for="{{all_sport_list}}" wx:key="index" wx:for-item="item">
          <van-checkbox value="{{ item.checked }}" data-item="{{ item }}" bind:change="onSportsChange">{{item.icon}}{{ item.name }}</van-checkbox>
        </block>
      </view>
  </van-dialog>
  <!-- 审核列表 -->
  <van-dialog
      use-slot
      cancel-button-text="关闭"
      z-index="100"
      title="审核列表"
      show="{{ showCheckList }}"
      show-confirm-button="{{false}}"  
      show-cancel-button="{{true}}"     
      confirm-button-open-type="getUserInfo"
      bind:close="onClose"
      custom-class="van-dialog-1"
    >
      <view class="check-box">
        <block wx:for="{{checkListData}}" wx:key="index" wx:for-item="item">
          <view class="check-container" wx:if="{{ !item.is_show }}">
            <view class="sport_addr"><text class="check-title">地址: </text><text class="check-content" selectable="true">{{ item.addr }}</text></view>
            <view class="sport_addr"><text class="check-title">简称: </text><text class="check-content" selectable="true">{{ item.tags }}</text></view>
            <view class="sport_key"><text class="check-title">运动: </text><text class="check-content">{{ item.sport_key }}</text></view>
            <view class="sport_key"><text class="check-title">类型: </text><text class="check-content">{{ item.update_type == 1 ? '添加' : '更新' }}</text></view>
            <view class="sport_key"><text class="check-title">城市: </text><text class="check-content">{{ item.city }}</text></view>
            <view class="sport_img">
              <text class="check-title">图片: </text><van-image custom-class="van-img-1" radius="10" fit="cover" src="{{item.img}}" data-src="{{item.img}}" bind:click="onPreviewImage" />
            </view>
            <view class="check-btn">
              <van-button bindtap="onAdd" data-value="{{ item }}" icon="https://ai.anythingai.online/static/profile3/smil.svg" custom-style="width: 170rpx" size="small" round type="info">通过</van-button>
              <van-button bindtap="onDelete" data-value="{{ item }}" icon="https://ai.anythingai.online/static/profile3/cry.svg" custom-style="width: 170rpx" size="small" round type="danger">拒绝</van-button>
            </view>
          </view>
        </block>
      </view>
  </van-dialog>
  <!-- 隐私协议 -->
  <van-action-sheet 
  show="{{ showPrivacy }}" 
  close-on-click-overlay="false"
  >
    <view class="privacy-title">
      <text>用户隐私协议</text>
    </view>
    <view class="privacy-center">
      <view class="privacy-content-f">
        <van-checkbox icon-size="17px" value="{{ privacyCheckedVal }}" shape="square" bind:change="onPrivacyCheckedChange"></van-checkbox>
        <text bind:tap="onPrivacyCheckedChange">我已阅读并同意</text><text class="privacy-jump" bind:tap="showUserPrivacyContent">《用户隐私协议》</text>
      </view>
      <view class="privacy-agree">
        <van-button custom-style="width: 190rpx" size="small" type="primary" data-item="1" bind:tap="iAacceptPrivacy">确认</van-button>
      </view>
    </view>
  </van-action-sheet>
   <!-- 隐私协议内容 -->
   <van-popup
    show="{{ showPrivacyContent }}"
    round
    custom-style="height: 50%;width: 80%;"
    bind:close="showUserPrivacyContent"
  >
    <view class="privacy-title">
      <text>用户隐私协议</text>
    </view>
    <view class="privacy-center">
      <view class="privacy-content">
        <text class="privacy-detail">欢迎使用本小程序！为保障您的合法权益，请您在使用前仔细阅读并同意以下条款：</text>
        <text class="privacy-detail"><text class="privacy-item">1.</text>您需遵守国家法律法规，禁止发布违法、违规、骚扰、攻击性等信息，违规行为将导致永久禁止您使用本小程序。</text> 
        <text class="privacy-detail"><text class="privacy-item">2.</text>您在本小程序中发布的信息及内容由您本人负责，如因内容引发的法律责任由用户自行承担。</text> 
        <text class="privacy-detail"><text class="privacy-item">3.</text>您在使用过程中若遇到问题或发现违规行为，可通过小程序内提供的反馈渠道联系我们。</text> 
      </view>
    </view>
    <view class="privacy-read">
      <van-button custom-style="width: 190rpx" size="small" type="default" data-item="1" bind:tap="privacyContentRead">已知晓</van-button>
    </view>
  </van-popup>
  <!-- 用户列表 -->
  <van-dialog
      use-slot
      cancel-button-text="关闭"
      z-index="100"
      title="用户列表"
      show="{{ showUserList }}"
      show-confirm-button="{{false}}"  
      show-cancel-button="{{true}}"     
      confirm-button-open-type="getUserInfo"
      bind:close="onCloseUserList"
      custom-class="van-dialog-1"
    >
      <view class="user-search">
        <van-search
          value="{{ userVal }}"
          input-align="center"
          placeholder="请输入搜索关键词"
          bindchange="searchUser"
        />
      </view>
      <view class="user-num">
        <text>总{{userCount}}用户</text>
      </view>
      <view class="check-box">
        <block wx:for="{{filter_user_list}}" wx:key="index" wx:for-item="item">
          <view class="check-container">
            <view class="sport_addr"><text class="check-title">用户: </text><text class="check-content" selectable="true">{{ item.openid }}</text></view>
            <view class="sport_addr"><text class="check-title">昵称: </text><text class="check-content" selectable="true">{{ item.nick_name ? item.nick_name : "null" }}</text></view>
            <view class="sport_addr"><text class="check-title">时间: </text><text class="check-content" selectable="true">{{ item.time }}</text></view>
            <view class="sport_img">
              <text class="check-title">头像: </text><van-image custom-class="van-img-1" radius="10" fit="cover" src="{{item.img}}" data-src="{{item.img}}" bind:click="onPreviewImage" />
            </view>
          </view>
        </block>
      </view>
  </van-dialog>
  <van-notify id="van-notify" />
  <van-toast id="van-toast" />
  <van-dialog id="van-dialog" />
</view>